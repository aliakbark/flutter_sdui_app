{
  "app_version_min": "1.0.0",
  "theme_tokens": {
    "color.primary": "#0A84FF",
    "color.bg": "#FFFFFF",
    "color.text": "#111827",
    "radius.md": 12,
    "space.sm": 8,
    "space.md": 16,
    "font.family": "SF Pro"
  },
  "workflows": [
    {
      "id": "onboarding_v1",
      "start_screen": "register_phone",
      "screens": [
        {
          "id": "register_phone",
          "title": "Create your account",
          "widgets": [
            {
              "type": "Text",
              "props": {
                "text": "Enter your mobile to get started.",
                "style": "title"
              }
            },
            {
              "type": "Spacer",
              "props": {
                "height": 24
              }
            },
            {
              "type": "TextField",
              "id": "phone",
              "label": "Mobile number",
              "props": {
                "keyboard": "phone",
                "hint": "+971 5x xxx xxxx"
              },
              "validators": [
                {
                  "type": "required",
                  "message": "Phone is required"
                },
                {
                  "type": "regex",
                  "pattern": "^\\+?[0-9]{9,15}$",
                  "message": "Invalid number"
                }
              ]
            },
            {
              "type": "Spacer",
              "props": {
                "height": 32
              }
            },
            {
              "type": "Button",
              "label": "Send OTP",
              "action": {
                "type": "capability.invoke",
                "capability": "auth-otp-send-v1",
                "params": {
                  "phone_ref": "phone"
                },
                "on_success": {
                  "navigate": "verify_otp"
                },
                "on_error": {
                  "show_toast": "Failed to send OTP"
                }
              }
            }
          ]
        },
        {
          "id": "verify_otp",
          "title": "Verify OTP",
          "widgets": [
            {
              "type": "Text",
              "props": {
                "text": "We've sent a code to your mobile.",
                "style": "title"
              }
            },
            {
              "type": "Spacer",
              "props": {
                "height": 24
              }
            },
            {
              "type": "OtpField",
              "id": "otp",
              "label": "6-digit code",
              "props": {
                "length": 6
              },
              "validators": [
                {
                  "type": "required",
                  "message": "OTP is required"
                },
                {
                  "type": "length",
                  "min": 6,
                  "max": 6,
                  "message": "Enter 6 digits"
                }
              ]
            },
            {
              "type": "Spacer",
              "props": {
                "height": 32
              }
            },
            {
              "type": "Row",
              "children": [
                {
                  "type": "Button",
                  "style": "secondary",
                  "label": "Resend",
                  "props": {
                    "fullWidth": false
                  },
                  "action": {
                    "type": "capability.invoke",
                    "capability": "auth-otp-send-v1",
                    "params": {
                      "phone_ref": "phone"
                    },
                    "on_success": {
                      "show_toast": "OTP resent"
                    }
                  }
                },
                {
                  "type": "Button",
                  "label": "Verify",
                  "props": {
                    "fullWidth": false
                  },
                  "action": {
                    "type": "capability.invoke",
                    "capability": "auth-otp-verify-v1",
                    "params": {
                      "otp_ref": "otp",
                      "phone_ref": "phone"
                    },
                    "on_success": {
                      "show_toast": "Welcome!",
                      "end_workflow": true
                    },
                    "on_error": {
                      "show_dialog": {
                        "title": "Invalid code",
                        "body": "Try again."
                      }
                    }
                  }
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
